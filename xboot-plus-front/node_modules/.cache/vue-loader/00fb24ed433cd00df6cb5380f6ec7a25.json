{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\setting-manage\\settingManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\setting-manage\\settingManage.vue","mtime":1651629755230},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1651770028580},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1651770027142},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\postcss-loader\\src\\index.js","mtime":1651770027415},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":1651770042155},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuL3NldHRpbmdNYW5hZ2UubGVzcyI7DQo="},{"version":3,"sources":["settingManage.vue"],"names":[],"mappings":";AACA","file":"settingManage.vue","sourceRoot":"src/views/sys/setting-manage","sourcesContent":["<style lang=\"less\">\r\n@import \"./settingManage.less\";\r\n</style>\r\n<template>\r\n  <div>\r\n    <Card>\r\n      <Layout>\r\n        <Sider\r\n          hide-trigger\r\n          style=\"background: #fff; max-width: 220px; flex: 0 0 220px\"\r\n        >\r\n          <Menu\r\n            :active-name=\"currName\"\r\n            theme=\"light\"\r\n            width=\"auto\"\r\n            @on-select=\"currName = $event\"\r\n          >\r\n            <MenuItem name=\"oss\">文件对象存储配置</MenuItem>\r\n            <MenuItem name=\"sms\">短信配置</MenuItem>\r\n            <MenuItem name=\"email\">邮件配置</MenuItem>\r\n            <MenuItem name=\"vaptcha\">Vaptcha验证码</MenuItem>\r\n            <MenuItem name=\"stopWord\">禁用词管理</MenuItem>\r\n            <MenuItem name=\"notice\">系统公告配置</MenuItem>\r\n            <MenuItem name=\"other\">其他配置</MenuItem>\r\n          </Menu>\r\n        </Sider>\r\n        <Content\r\n          :style=\"{\r\n            padding: '8px 40px',\r\n            minHeight: '550px',\r\n            background: '#fff',\r\n          }\"\r\n        >\r\n          <div v-show=\"currName == 'oss'\">\r\n            <div class=\"setting-title\">文件对象存储配置</div>\r\n            <oss />\r\n          </div>\r\n          <div v-show=\"currName == 'sms'\">\r\n            <div class=\"setting-title\">短信配置</div>\r\n            <sms />\r\n          </div>\r\n          <div v-show=\"currName == 'email'\">\r\n            <div class=\"setting-title\">邮箱配置</div>\r\n            <div style=\"display: flex; position: relative\">\r\n              <Form\r\n                ref=\"emailForm\"\r\n                :model=\"email\"\r\n                :label-width=\"110\"\r\n                label-position=\"left\"\r\n                :rules=\"emailValidate\"\r\n              >\r\n                <FormItem label=\"邮箱服务器\" prop=\"host\">\r\n                  <Input\r\n                    type=\"text\"\r\n                    v-model=\"email.host\"\r\n                    placeholder=\"请输入邮箱服务器Host，例如QQ邮箱为smtp.qq.com\"\r\n                    style=\"width: 380px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem label=\"发送邮箱账号\" prop=\"username\">\r\n                  <Input\r\n                    type=\"text\"\r\n                    v-model=\"email.username\"\r\n                    placeholder=\"请输入发送者Email账号\"\r\n                    style=\"width: 380px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem label=\"邮箱授权码\" prop=\"password\">\r\n                  <Tooltip\r\n                    placement=\"right\"\r\n                    content=\"无法编辑时请先点击查看图标\"\r\n                  >\r\n                    <Input\r\n                      class=\"input-see\"\r\n                      type=\"text\"\r\n                      v-model=\"email.password\"\r\n                      :readonly=\"!changedEmailPass\"\r\n                      @on-click=\"seeSecret('EMAIL_SETTING')\"\r\n                      icon=\"ios-eye\"\r\n                      placeholder=\"请输入邮箱授权码，进入邮箱-设置中可找到\"\r\n                      style=\"width: 380px\"\r\n                    />\r\n                  </Tooltip>\r\n                </FormItem>\r\n                <FormItem>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    style=\"width: 100px\"\r\n                    :loading=\"saveLoading\"\r\n                    @click=\"saveEditEmail\"\r\n                    >保存更改</Button\r\n                  >\r\n                </FormItem>\r\n              </Form>\r\n              <Spin fix v-if=\"loading\"></Spin>\r\n            </div>\r\n          </div>\r\n          <div v-show=\"currName == 'vaptcha'\">\r\n            <div class=\"setting-title\">Vaptcha验证码配置</div>\r\n            <div style=\"display: flex; position: relative\">\r\n              <Form\r\n                ref=\"vaptchaForm\"\r\n                :model=\"vaptcha\"\r\n                :label-width=\"110\"\r\n                label-position=\"left\"\r\n                :rules=\"vaptchaValidate\"\r\n              >\r\n                <FormItem label=\"VID\" prop=\"vid\">\r\n                  <Input\r\n                    type=\"text\"\r\n                    v-model=\"vaptcha.vid\"\r\n                    placeholder=\"请输入验证单元VID\"\r\n                    style=\"width: 380px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem label=\"secretKey\" prop=\"secretKey\">\r\n                  <Tooltip\r\n                    placement=\"right\"\r\n                    content=\"无法编辑时请先点击查看图标\"\r\n                  >\r\n                    <Input\r\n                      class=\"input-see\"\r\n                      type=\"text\"\r\n                      v-model=\"vaptcha.secretKey\"\r\n                      :readonly=\"!changedVaptchaSK\"\r\n                      @on-click=\"seeSecret('VAPTCHA_SETTING')\"\r\n                      icon=\"ios-eye\"\r\n                      placeholder=\"请输入验证单元Key\"\r\n                      style=\"width: 380px\"\r\n                    />\r\n                  </Tooltip>\r\n                </FormItem>\r\n                <FormItem>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    style=\"width: 100px\"\r\n                    :loading=\"saveLoading\"\r\n                    @click=\"saveEditVaptcha\"\r\n                    >保存更改</Button\r\n                  >\r\n                </FormItem>\r\n              </Form>\r\n              <Spin fix v-if=\"loading\"></Spin>\r\n            </div>\r\n          </div>\r\n          <div v-show=\"currName == 'stopWord'\">\r\n            <div class=\"setting-title\">禁用词管理</div>\r\n            <stop-word />\r\n          </div>\r\n          <div v-show=\"currName == 'notice'\">\r\n            <div class=\"setting-title\">\r\n              系统公告配置\r\n              <Tooltip content=\"访问系统公告，右上角弹出\" placement=\"right\">\r\n                <Icon\r\n                  type=\"md-help-circle\"\r\n                  size=\"20\"\r\n                  color=\"#c5c5c5\"\r\n                  style=\"margin-left: 10px; cursor: pointer\"\r\n                />\r\n              </Tooltip>\r\n            </div>\r\n            <div style=\"display: flex\">\r\n              <Form\r\n                ref=\"noticeForm\"\r\n                :model=\"notice\"\r\n                :label-width=\"110\"\r\n                label-position=\"left\"\r\n              >\r\n                <FormItem label=\"公告开关\" prop=\"open\">\r\n                  <i-switch v-model=\"notice.open\">\r\n                    <span slot=\"open\">开</span>\r\n                    <span slot=\"close\">关</span>\r\n                  </i-switch>\r\n                </FormItem>\r\n                <FormItem label=\"展示时长\" prop=\"duration\">\r\n                  <Tooltip\r\n                    trigger=\"hover\"\r\n                    placement=\"right\"\r\n                    content=\"设为0不自动关闭\"\r\n                  >\r\n                    <InputNumber\r\n                      :max=\"1000\"\r\n                      :min=\"0\"\r\n                      v-model=\"notice.duration\"\r\n                    ></InputNumber\r\n                    ><span style=\"margin-left: 5px\">秒</span>\r\n                  </Tooltip>\r\n                </FormItem>\r\n                <FormItem label=\"展示页面\" prop=\"position\">\r\n                  <Select\r\n                    v-model=\"notice.position\"\r\n                    placeholder=\"请选择\"\r\n                    style=\"width: 380px\"\r\n                  >\r\n                    <Option value=\"LOGIN\">登录页（访问系统时）</Option>\r\n                    <Option value=\"HOME\">首页（登录系统后）</Option>\r\n                  </Select>\r\n                </FormItem>\r\n                <FormItem label=\"公告标题\" prop=\"title\">\r\n                  <Input v-model=\"notice.title\" style=\"width: 380px\" />\r\n                </FormItem>\r\n                <FormItem label=\"公告内容\" prop=\"content\">\r\n                  <Input\r\n                    type=\"textarea\"\r\n                    v-model=\"notice.content\"\r\n                    :rows=\"4\"\r\n                    placeholder\r\n                    style=\"width: 380px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    style=\"width: 100px\"\r\n                    :loading=\"saveLoading\"\r\n                    @click=\"saveEditNotice\"\r\n                    >保存更改</Button\r\n                  >\r\n                </FormItem>\r\n              </Form>\r\n              <Spin fix v-if=\"loading\"></Spin>\r\n            </div>\r\n          </div>\r\n          <div v-show=\"currName == 'other'\">\r\n            <div class=\"setting-title\">其他配置</div>\r\n            <div style=\"display: flex\">\r\n              <Form\r\n                ref=\"otherForm\"\r\n                :model=\"other\"\r\n                :label-width=\"110\"\r\n                label-position=\"left\"\r\n                :rules=\"otherValidate\"\r\n              >\r\n                <FormItem label=\"应用部署域名\" prop=\"domain\">\r\n                  <Tooltip placement=\"right\" content=\"拼接部分资源访问链接使用\">\r\n                    <Input\r\n                      type=\"text\"\r\n                      v-model=\"other.domain\"\r\n                      placeholder=\"请输入应用部署域名前缀，如http://xboot.exrick.cn\"\r\n                      style=\"width: 380px\"\r\n                    />\r\n                  </Tooltip>\r\n                </FormItem>\r\n                <FormItem label=\"单点登录域名\" prop=\"ssoDomain\">\r\n                  <Tooltip\r\n                    max-width=\"250\"\r\n                    transfer\r\n                    placement=\"right\"\r\n                    content=\"该域名及子域名下将可获得单点登录所需数据\"\r\n                  >\r\n                    <Input\r\n                      type=\"text\"\r\n                      v-model=\"other.ssoDomain\"\r\n                      placeholder=\"请输入应用部署一级域名，如exrick.cn\"\r\n                      style=\"width: 380px\"\r\n                    />\r\n                  </Tooltip>\r\n                </FormItem>\r\n                <FormItem label=\"IP黑名单\" prop=\"blacklist\">\r\n                  <Input\r\n                    type=\"textarea\"\r\n                    v-model=\"other.blacklist\"\r\n                    :rows=\"4\"\r\n                    placeholder=\"多个以回车分隔\"\r\n                    style=\"width: 380px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    style=\"width: 100px\"\r\n                    :loading=\"saveLoading\"\r\n                    @click=\"saveEditOther\"\r\n                    >保存更改</Button\r\n                  >\r\n                </FormItem>\r\n              </Form>\r\n              <Spin fix v-if=\"loading\"></Spin>\r\n            </div>\r\n          </div>\r\n        </Content>\r\n      </Layout>\r\n    </Card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  seeSecretSet,\r\n  getEmailSet,\r\n  editEmailSet,\r\n  getVaptchaSet,\r\n  editVaptchaSet,\r\n  getOtherSet,\r\n  editOtherSet,\r\n  getNoticeSet,\r\n  editNoticeSet\r\n} from \"@/api/index\";\r\nimport oss from \"./oss.vue\";\r\nimport sms from \"./sms.vue\";\r\nimport stopWord from \"./stopWord.vue\";\r\nexport default {\r\n  name: \"setting-manage\",\r\n  components: {\r\n    oss,\r\n    sms,\r\n    stopWord,\r\n  },\r\n  data() {\r\n    return {\r\n      currName: \"oss\",\r\n      loading: false, // 表单加载状态\r\n      saveLoading: false,\r\n      email: {\r\n        host: \"\",\r\n        username: \"\",\r\n        password: \"\",\r\n      },\r\n      changedEmailPass: false, // 是否修改邮件密码\r\n      vaptcha: {\r\n        vID: \"\",\r\n        secretKey: \"\",\r\n      },\r\n      changedVaptchaSK: false, // 是否修改Vaptcha的secrectKey\r\n      notice: {\r\n        duration: 10,\r\n      },\r\n      other: {\r\n        domain: \"http://127.0.0.1:8888\",\r\n        ssoDomain: \"\",\r\n        blacklist: \"\",\r\n      },\r\n      emailValidate: {\r\n        // 表单验证规则\r\n        host: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        username: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        password: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n      },\r\n      vaptchaValidate: {\r\n        // 表单验证规则\r\n        vid: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        secretKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n      },\r\n      otherValidate: {\r\n        // 表单验证规则\r\n        domain: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n      },\r\n      \r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.initEmailSet();\r\n      this.initVaptchaSet();\r\n      this.initNoticeSet();\r\n      this.initOtherSet();\r\n    },\r\n    initEmailSet() {\r\n      this.loading = true;\r\n      getEmailSet().then((res) => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] == null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.email = res.result;\r\n        } else {\r\n          this.changedEmailPass = true;\r\n        }\r\n      });\r\n    },\r\n    initVaptchaSet() {\r\n      this.loading = true;\r\n      getVaptchaSet().then((res) => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] == null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.vaptcha = res.result;\r\n        } else {\r\n          this.changedVaptchaSK = true;\r\n        }\r\n      });\r\n    },\r\n    initOtherSet() {\r\n      this.loading = true;\r\n      getOtherSet().then((res) => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] == null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.other = res.result;\r\n        }\r\n      });\r\n    },\r\n    initNoticeSet() {\r\n      this.loading = true;\r\n      getNoticeSet().then((res) => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] == null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.notice = res.result;\r\n        }\r\n      });\r\n    },\r\n    seeSecret(name) {\r\n      if (!name) {\r\n        return;\r\n      }\r\n      seeSecretSet(name).then((res) => {\r\n        if (res.success) {\r\n          if (this.currName == \"sms\") {\r\n            this.sms.secretKey = res.result;\r\n            this.changedSmsSK = true;\r\n          } else if (this.currName == \"email\") {\r\n            this.email.password = res.result;\r\n            this.changedEmailPass = true;\r\n          } else if (this.currName == \"vaptcha\") {\r\n            this.vaptcha.secretKey = res.result;\r\n            this.changedVaptchaSK = true;\r\n          }\r\n        }\r\n      });\r\n    },\r\n    saveEditEmail() {\r\n      this.$refs.emailForm.validate((valid) => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.email.changed = this.changedEmailPass;\r\n          editEmailSet(this.email).then((res) => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditVaptcha() {\r\n      this.$refs.vaptchaForm.validate((valid) => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.vaptcha.changed = this.changedVaptchaSK;\r\n          editVaptchaSet(this.vaptcha).then((res) => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditOther() {\r\n      this.$refs.otherForm.validate((valid) => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          editOtherSet(this.other).then((res) => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditNotice() {\r\n      this.saveLoading = true;\r\n      let str = JSON.stringify(this.notice);\r\n      let params = JSON.parse(str);\r\n      if (!this.notice.duration) {\r\n        params.duration = 0;\r\n      }\r\n      editNoticeSet(params).then((res) => {\r\n        this.saveLoading = false;\r\n        if (res.success) {\r\n          this.$Message.success(\"保存成功\");\r\n        }\r\n      });\r\n    },\r\n  },\r\n  mounted() {\r\n    let name = this.$route.query.name;\r\n    if (name) {\r\n      this.currName = name;\r\n    }\r\n    this.init();\r\n  },\r\n};\r\n</script>"]}]}
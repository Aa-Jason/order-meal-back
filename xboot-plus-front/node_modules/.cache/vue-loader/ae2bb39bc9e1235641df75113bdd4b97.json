{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\menu-manage\\menuManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\menu-manage\\menuManage.vue","mtime":1651629755222},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1651770028580},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1651770027142},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\postcss-loader\\src\\index.js","mtime":1651770027415},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":1651770042155},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICJAL3N0eWxlcy90cmVlLWNvbW1vbi5sZXNzIjsNCkBpbXBvcnQgIi4vbWVudU1hbmFnZS5sZXNzIjsNCg=="},{"version":3,"sources":["menuManage.vue"],"names":[],"mappings":";AACA;AACA","file":"menuManage.vue","sourceRoot":"src/views/sys/menu-manage","sourcesContent":["<style lang=\"less\">\r\n@import \"@/styles/tree-common.less\";\r\n@import \"./menuManage.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card>\r\n      <Row class=\"operation\" align=\"middle\" justify=\"space-between\">\r\n        <div>\r\n          <Button\r\n            @click=\"add\"\r\n            type=\"primary\"\r\n            icon=\"md-add\"\r\n            v-show=\"showType == 'tree'\"\r\n            >添加子节点</Button\r\n          >\r\n          <Button @click=\"addRoot\" icon=\"md-add\">添加顶部菜单</Button>\r\n          <Button @click=\"delAll\" icon=\"md-trash\">批量删除</Button>\r\n          <Button\r\n            @click=\"getParentList\"\r\n            icon=\"md-refresh\"\r\n            v-show=\"showType == 'list'\"\r\n            >刷新</Button\r\n          >\r\n          <Dropdown @on-click=\"handleDropdown\" v-show=\"showType == 'tree'\">\r\n            <Button>\r\n              更多操作\r\n              <Icon type=\"md-arrow-dropdown\"></Icon>\r\n            </Button>\r\n            <DropdownMenu slot=\"list\">\r\n              <DropdownItem name=\"refresh\">刷新</DropdownItem>\r\n              <DropdownItem name=\"expandOne\">收合所有</DropdownItem>\r\n              <DropdownItem name=\"expandTwo\">仅展开一级</DropdownItem>\r\n              <DropdownItem name=\"expandThree\">仅展开两级</DropdownItem>\r\n              <DropdownItem name=\"expandAll\">展开所有</DropdownItem>\r\n            </DropdownMenu>\r\n          </Dropdown>\r\n          <Input\r\n            v-model=\"searchKey\"\r\n            suffix=\"ios-search\"\r\n            @on-change=\"search\"\r\n            placeholder=\"输入菜单名搜索\"\r\n            clearable\r\n            style=\"width: 250px\"\r\n            v-show=\"showType == 'list'\"\r\n          />\r\n          <i-switch\r\n            v-model=\"strict\"\r\n            size=\"large\"\r\n            style=\"margin-left: 5px\"\r\n            v-show=\"showType == 'tree'\"\r\n          >\r\n            <span slot=\"open\">级联</span>\r\n            <span slot=\"close\">单选</span>\r\n          </i-switch>\r\n        </div>\r\n        <div>\r\n          <RadioGroup v-model=\"showType\" type=\"button\">\r\n            <Radio title=\"树结构\" label=\"tree\">\r\n              <Icon type=\"md-list\"></Icon>\r\n            </Radio>\r\n            <Radio title=\"列表\" label=\"list\">\r\n              <Icon type=\"ios-apps\"></Icon>\r\n            </Radio>\r\n          </RadioGroup>\r\n        </div>\r\n      </Row>\r\n      <Alert show-icon v-show=\"showType == 'list'\">\r\n        已选择\r\n        <span class=\"select-count\">{{ selectList.length }}</span> 项\r\n        <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n      </Alert>\r\n      <Table\r\n        row-key=\"title\"\r\n        :load-data=\"loadData\"\r\n        :columns=\"columns\"\r\n        :data=\"tableData\"\r\n        :loading=\"loading\"\r\n        border\r\n        :update-show-children=\"true\"\r\n        ref=\"table\"\r\n        @on-selection-change=\"showSelect\"\r\n        v-if=\"showType == 'list'\"\r\n      ></Table>\r\n      <Row type=\"flex\" justify=\"start\" :gutter=\"16\" v-show=\"showType == 'tree'\">\r\n        <Col :sm=\"8\" :md=\"8\" :lg=\"8\" :xl=\"6\">\r\n          <Alert show-icon>\r\n            当前选择编辑：\r\n            <span class=\"select-title\">{{ editTitle }}</span>\r\n            <a\r\n              class=\"select-clear\"\r\n              v-show=\"form.id && editTitle\"\r\n              @click=\"cancelEdit\"\r\n              >取消选择</a\r\n            >\r\n          </Alert>\r\n          <Input\r\n            v-model=\"searchKey\"\r\n            suffix=\"ios-search\"\r\n            @on-change=\"search\"\r\n            placeholder=\"输入菜单名搜索\"\r\n            clearable\r\n          />\r\n          <div style=\"position: relative\">\r\n            <div class=\"tree-bar\" :style=\"{ maxHeight: maxHeight }\">\r\n              <Tree\r\n                ref=\"tree\"\r\n                :data=\"data\"\r\n                show-checkbox\r\n                :render=\"renderContent\"\r\n                @on-select-change=\"selectTree\"\r\n                @on-check-change=\"changeSelect\"\r\n                :check-strictly=\"!strict\"\r\n              ></Tree>\r\n            </div>\r\n            <Spin size=\"large\" fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </Col>\r\n        <Col :sm=\"16\" :md=\"16\" :lg=\"16\" :xl=\"9\">\r\n          <Form ref=\"form\" :model=\"form\" :label-width=\"110\">\r\n            <FormItem label=\"类型\" prop=\"type\">\r\n              <div v-show=\"form.type == -1\">\r\n                <Icon\r\n                  type=\"ios-navigate-outline\"\r\n                  size=\"16\"\r\n                  style=\"margin-right: 5px\"\r\n                ></Icon>\r\n                <span>顶部菜单</span>\r\n              </div>\r\n              <div v-show=\"form.type == 0\">\r\n                <Icon\r\n                  type=\"ios-list-box-outline\"\r\n                  size=\"16\"\r\n                  style=\"margin-right: 5px\"\r\n                ></Icon>\r\n                <span>页面菜单</span>\r\n              </div>\r\n              <div v-show=\"form.type == 1\">\r\n                <Icon\r\n                  type=\"md-radio-button-on\"\r\n                  size=\"16\"\r\n                  style=\"margin-right: 5px\"\r\n                ></Icon>\r\n                <span>操作按钮</span>\r\n              </div>\r\n            </FormItem>\r\n            <FormItem label=\"上级菜单\" prop=\"parentTitle\" class=\"form-noheight\">\r\n              <div style=\"display: flex\">\r\n                <Input\r\n                  v-model=\"form.parentTitle\"\r\n                  readonly\r\n                  style=\"margin-right: 10px\"\r\n                />\r\n                <Poptip\r\n                  transfer\r\n                  trigger=\"click\"\r\n                  placement=\"right-start\"\r\n                  title=\"选择上级菜单\"\r\n                  width=\"250\"\r\n                >\r\n                  <Button icon=\"md-list\">选择菜单</Button>\r\n                  <div slot=\"content\" class=\"tree-bar tree-select\">\r\n                    <Tree\r\n                      :data=\"dataEdit\"\r\n                      @on-select-change=\"selectTreeEdit\"\r\n                    ></Tree>\r\n                    <Spin size=\"large\" fix v-if=\"loading\"></Spin>\r\n                  </div>\r\n                </Poptip>\r\n              </div>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"名称\"\r\n              prop=\"title\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '名称不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == -1 || form.type == 0\"\r\n            >\r\n              <div style=\"display: flex\">\r\n                <div style=\"width: 100%\">\r\n                  <Input v-model=\"form.title\">\r\n                    <Poptip\r\n                      transfer\r\n                      trigger=\"hover\"\r\n                      title=\"多语言\"\r\n                      placement=\"right\"\r\n                      width=\"350\"\r\n                      style=\"width: 17px; cursor: pointer\"\r\n                      slot=\"append\"\r\n                    >\r\n                      <Button icon=\"ios-globe-outline\"></Button>\r\n                      <div slot=\"content\">\r\n                        <Form :label-width=\"80\">\r\n                          <FormItem label=\"启用多语言\">\r\n                            <i-switch v-model=\"form.localize\" size=\"large\">\r\n                              <span slot=\"open\">开</span>\r\n                              <span slot=\"close\">关</span>\r\n                            </i-switch>\r\n                          </FormItem>\r\n                          <FormItem label=\"多语言Key\">\r\n                            <Input\r\n                              v-model=\"form.i18n\"\r\n                              placeholder=\"输入用于渲染I18n的$t('KEY')\"\r\n                            ></Input>\r\n                          </FormItem>\r\n                        </Form>\r\n                      </div>\r\n                    </Poptip>\r\n                  </Input>\r\n                </div>\r\n              </div>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"名称\"\r\n              prop=\"title\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '名称不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == 1\"\r\n              class=\"block-tool\"\r\n            >\r\n              <Tooltip placement=\"right\" content=\"操作按钮名称不得重复\">\r\n                <Input v-model=\"form.title\" />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"路径\"\r\n              prop=\"path\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '路径不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == 0\"\r\n            >\r\n              <Input v-model=\"form.path\" />\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"请求路径\"\r\n              prop=\"path\"\r\n              v-if=\"form.type == 1\"\r\n              class=\"block-tool\"\r\n              :required=\"false\"\r\n            >\r\n              <Tooltip\r\n                placement=\"right\"\r\n                :max-width=\"230\"\r\n                transfer\r\n                content=\"填写后端请求URL，后端将作权限拦截，若无可留空\"\r\n              >\r\n                <Input v-model=\"form.path\" />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"按钮权限类型\"\r\n              prop=\"buttonType\"\r\n              v-if=\"form.type == 1\"\r\n            >\r\n              <dict\r\n                dict=\"permission_type\"\r\n                v-model=\"form.buttonType\"\r\n                placeholder=\"请选择或输入搜索\"\r\n                filterable\r\n                clearable\r\n              />\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"英文名\"\r\n              prop=\"name\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '英文名不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == -1\"\r\n              class=\"block-tool\"\r\n            >\r\n              <Tooltip placement=\"right\" content=\"需唯一\">\r\n                <Input v-model=\"form.name\" />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"路由英文名\"\r\n              prop=\"name\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '路由英文名不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == 0\"\r\n              class=\"block-tool\"\r\n            >\r\n              <Tooltip placement=\"right\" content=\"需唯一\" transfer>\r\n                <Input v-model=\"form.name\" />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"图标\"\r\n              prop=\"icon\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '图标不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == -1 || form.type == 0\"\r\n            >\r\n              <icon-choose\r\n                showCustom\r\n                showInput\r\n                v-model=\"form.icon\"\r\n              ></icon-choose>\r\n            </FormItem>\r\n            <FormItem label=\"显示红点\" prop=\"component\" v-if=\"form.type == -1\">\r\n              <i-switch\r\n                size=\"large\"\r\n                v-model=\"form.component\"\r\n                :true-value=\"'hot'\"\r\n                :false-value=\"'normal'\"\r\n              >\r\n                <span slot=\"open\">开</span>\r\n                <span slot=\"close\">关</span>\r\n              </i-switch>\r\n            </FormItem>\r\n            <FormItem label=\"系统站内菜单\" prop=\"isMenu\" v-if=\"form.type == -1\">\r\n              <i-switch size=\"large\" v-model=\"form.isMenu\">\r\n                <span slot=\"open\">是</span>\r\n                <span slot=\"close\">否</span>\r\n              </i-switch>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"其他链接\"\r\n              prop=\"url\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '其他链接不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == -1 && !form.isMenu\"\r\n            >\r\n              <Input v-model=\"form.url\" placeholder=\"Http链接或路由名\" />\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"打开方式\"\r\n              prop=\"description\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '请选择打开方式',\r\n                trigger: 'change',\r\n              }\"\r\n              v-if=\"form.type == -1 && !form.isMenu\"\r\n            >\r\n              <Select v-model=\"form.description\" placeholder=\"请选择\">\r\n                <Option value=\"direct\" label=\"直接跳转\">\r\n                  <span style=\"margin-right: 10px\">直接跳转</span>\r\n                  <span style=\"color: #ccc\">其他链接填写完整链接</span>\r\n                </Option>\r\n                <Option value=\"window\" label=\"新窗口打开\">\r\n                  <span style=\"margin-right: 10px\">新窗口打开</span>\r\n                  <span style=\"color: #ccc\">其他链接填写完整链接</span>\r\n                </Option>\r\n                <Option value=\"route\" label=\"站内路由\">\r\n                  <span style=\"margin-right: 10px\">站内路由</span>\r\n                  <span style=\"color: #ccc\">其他链接填写Vue路由名</span>\r\n                </Option>\r\n              </Select>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"前端组件\"\r\n              prop=\"component\"\r\n              :rules=\"{\r\n                required: true,\r\n                message: '前端组件不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n              v-if=\"form.type == 0\"\r\n            >\r\n              <Input v-model=\"form.component\" />\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"第三方链接\"\r\n              prop=\"url\"\r\n              v-if=\"form.type == 0 && form.level == 2\"\r\n              :required=\"false\"\r\n            >\r\n              <Input\r\n                v-model=\"form.url\"\r\n                placeholder=\"http://\"\r\n                @on-change=\"changeEditUrl\"\r\n              />\r\n              <span class=\"url-remark\"\r\n                >前端组件需为 sys/monitor/monitor 时生效</span\r\n              >\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"排序值\"\r\n              prop=\"sortOrder\"\r\n              :rules=\"{\r\n                required: true,\r\n                type: 'number',\r\n                message: '前端组件不能为空',\r\n                trigger: 'blur',\r\n              }\"\r\n            >\r\n              <Tooltip\r\n                trigger=\"hover\"\r\n                placement=\"right\"\r\n                content=\"值越小越靠前，支持小数\"\r\n              >\r\n                <InputNumber\r\n                  :max=\"1000\"\r\n                  :min=\"0\"\r\n                  v-model=\"form.sortOrder\"\r\n                ></InputNumber>\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem\r\n              label=\"始终显示\"\r\n              prop=\"showAlways\"\r\n              v-if=\"form.level == 1\"\r\n              class=\"block-tool\"\r\n            >\r\n              <i-switch size=\"large\" v-model=\"form.showAlways\">\r\n                <span slot=\"open\">是</span>\r\n                <span slot=\"close\">否</span>\r\n              </i-switch>\r\n              <Tooltip\r\n                content=\"当设为不始终显示时，一级菜单下仅有一个子级菜单只会显示该子级菜单，避免用户多次点击\"\r\n                placement=\"right\"\r\n                transfer\r\n                max-width=\"280\"\r\n                style=\"display: inline-block !important\"\r\n              >\r\n                <Icon\r\n                  type=\"md-help-circle\"\r\n                  size=\"20\"\r\n                  color=\"#c5c5c5\"\r\n                  style=\"margin-left: 10px; cursor: pointer\"\r\n                />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <FormItem label=\"是否启用\" prop=\"status\">\r\n              <i-switch\r\n                size=\"large\"\r\n                v-model=\"form.status\"\r\n                :true-value=\"0\"\r\n                :false-value=\"-1\"\r\n              >\r\n                <span slot=\"open\">启用</span>\r\n                <span slot=\"close\">禁用</span>\r\n              </i-switch>\r\n            </FormItem>\r\n            <FormItem>\r\n              <Button\r\n                style=\"margin-right: 5px\"\r\n                @click=\"submitEdit\"\r\n                :loading=\"submitLoading\"\r\n                :disabled=\"!form.id || !editTitle\"\r\n                type=\"primary\"\r\n                >修改并保存</Button\r\n              >\r\n              <Button @click=\"handleReset\">重置</Button>\r\n            </FormItem>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n    </Card>\r\n\r\n    <add\r\n      :form=\"form\"\r\n      :isRoot=\"isRoot\"\r\n      :dataLength=\"data.length\"\r\n      v-model=\"showAdd\"\r\n      @on-submit=\"addSuccess\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  loadPermission,\r\n  editPermission,\r\n  deletePermission,\r\n  searchPermission,\r\n} from \"@/api/index\";\r\nimport dict from \"@/views/my-components/xboot/dict\";\r\nimport IconChoose from \"@/views/my-components/xboot/icon-choose\";\r\nimport util from \"@/libs/util.js\";\r\nimport add from \"./add.vue\";\r\nexport default {\r\n  name: \"menu-manage\",\r\n  components: {\r\n    dict,\r\n    IconChoose,\r\n    add,\r\n  },\r\n  data() {\r\n    return {\r\n      showType: \"tree\",\r\n      columns: [\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          title: \"菜单名称\",\r\n          key: \"title\",\r\n          minWidth: 150,\r\n          sortable: true,\r\n          tree: true,\r\n        },\r\n        {\r\n          title: \"英文名\",\r\n          key: \"name\",\r\n          minWidth: 100,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"类型\",\r\n          key: \"type\",\r\n          minWidth: 120,\r\n          sortable: true,\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            let icon = \"\",\r\n              type = \"\",\r\n              level = params.row.level;\r\n            if (level == 0) {\r\n              icon = \"ios-navigate\";\r\n              type = \"顶部菜单\";\r\n            } else if (level == 1) {\r\n              icon = \"md-list-box\";\r\n              type = \"页面菜单\";\r\n            } else if (level == 2) {\r\n              icon = \"md-list\";\r\n              type = \"页面菜单\";\r\n            } else if (level == 3) {\r\n              icon = \"md-radio-button-on\";\r\n              type = \"操作按钮\";\r\n            } else {\r\n              icon = \"md-radio-button-off\";\r\n            }\r\n            return h(\"div\", [\r\n              h(\"Icon\", {\r\n                props: {\r\n                  type: icon,\r\n                },\r\n                style: {\r\n                  margin: \"0 5px 0 0\",\r\n                },\r\n              }),\r\n              h(\"span\", type),\r\n            ]);\r\n          },\r\n        },\r\n        {\r\n          title: \"图标\",\r\n          key: \"icon\",\r\n          minWidth: 100,\r\n          sortable: true,\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\"XIcon\", {\r\n                props: {\r\n                  type: params.row.icon,\r\n                },\r\n              }),\r\n            ]);\r\n          },\r\n        },\r\n        {\r\n          title: \"路径/URL\",\r\n          minWidth: 100,\r\n          key: \"path\",\r\n          tooltip: true,\r\n        },\r\n        {\r\n          title: \"排序\",\r\n          key: \"sortOrder\",\r\n          minWidth: 100,\r\n          sortable: true,\r\n          align: \"center\",\r\n          sortType: \"asc\",\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          width: 170,\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          width: 200,\r\n          fixed: \"right\",\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\r\n                \"a\",\r\n                {\r\n                  on: {\r\n                    click: () => {\r\n                      this.tableAdd(params.row);\r\n                    },\r\n                  },\r\n                },\r\n                \"添加子节点\"\r\n              ),\r\n              h(\"Divider\", {\r\n                props: {\r\n                  type: \"vertical\",\r\n                },\r\n              }),\r\n              h(\r\n                \"a\",\r\n                {\r\n                  on: {\r\n                    click: () => {\r\n                      this.remove(params.row);\r\n                    },\r\n                  },\r\n                },\r\n                \"删除\"\r\n              ),\r\n            ]);\r\n          },\r\n        },\r\n      ],\r\n      loading: true,\r\n      strict: true,\r\n      maxHeight: \"500px\",\r\n      expandLevel: 1,\r\n      selectList: [],\r\n      searchKey: \"\",\r\n      parentTitle: \"\",\r\n      isRoot: false,\r\n      showAdd: false,\r\n      editTitle: \"\",\r\n      form: {\r\n        id: \"\",\r\n        title: \"\",\r\n        name: \"\",\r\n        icon: \"\",\r\n        path: \"\",\r\n        component: \"\",\r\n        parentId: \"\",\r\n        buttonType: \"\",\r\n        isMenu: true,\r\n        type: -1,\r\n        sortOrder: 0,\r\n        level: 0,\r\n        status: 0,\r\n        url: \"\",\r\n        showAlways: true,\r\n        parentTitle: \"\",\r\n      },\r\n      submitLoading: false,\r\n      data: [],\r\n      dataEdit: [],\r\n      tableData: [],\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getAllList();\r\n      this.getParentList(null, true);\r\n    },\r\n    getParentList(f, notShowLoading) {\r\n      if (!notShowLoading) {\r\n        this.loading = true;\r\n      }\r\n      loadPermission(\"0\").then((res) => {\r\n        if (!notShowLoading) {\r\n          this.loading = false;\r\n        }\r\n        if (res.success) {\r\n          res.result.forEach(function (e) {\r\n            if (e.isParent) {\r\n              e.children = [];\r\n              e._loading = false;\r\n            }\r\n          });\r\n          this.tableData = res.result;\r\n        }\r\n      });\r\n    },\r\n    loadData(item, callback) {\r\n      loadPermission(item.id).then((res) => {\r\n        if (res.success) {\r\n          res.result.forEach(function (e) {\r\n            if (e.isParent) {\r\n              e.children = [];\r\n              e._loading = false;\r\n            }\r\n          });\r\n          callback(res.result);\r\n        }\r\n      });\r\n    },\r\n    renderContent(h, { root, node, data }) {\r\n      let icon = \"md-radio-button-off\";\r\n      if (data.level == 0) {\r\n        icon = \"ios-navigate\";\r\n      } else if (data.level == 1) {\r\n        icon = \"md-list-box\";\r\n      } else if (data.level == 2) {\r\n        icon = \"md-list\";\r\n      } else if (data.level == 3) {\r\n        icon = \"md-radio-button-on\";\r\n      }\r\n      return h(\"span\", [\r\n        h(\"span\", [\r\n          h(\"Icon\", {\r\n            props: {\r\n              type: icon,\r\n              size: \"16\",\r\n            },\r\n            style: {\r\n              \"margin-right\": \"8px\",\r\n              \"margin-bottom\": \"3px\",\r\n            },\r\n          }),\r\n          h(\"span\", data.title),\r\n        ]),\r\n      ]);\r\n    },\r\n    handleDropdown(name) {\r\n      if (name == \"expandOne\") {\r\n        this.expandLevel = 1;\r\n      } else if (name == \"expandTwo\") {\r\n        this.expandLevel = 2;\r\n      } else if (name == \"expandThree\") {\r\n        this.expandLevel = 3;\r\n      } else if (name == \"expandAll\") {\r\n        this.expandLevel = 4;\r\n      }\r\n      this.getAllList();\r\n    },\r\n    getAllList() {\r\n      this.loading = true;\r\n      this.getRequest(\"/permission/getAllList\").then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          // 仅展开指定级数 默认后端已展开所有\r\n          let expandLevel = this.expandLevel;\r\n          res.result.forEach(function (e) {\r\n            if (expandLevel == 1) {\r\n              if (e.level == 0) {\r\n                e.expand = false;\r\n              }\r\n              if (e.children && e.children.length > 0) {\r\n                e.children.forEach(function (c) {\r\n                  if (c.level == 1) {\r\n                    c.expand = false;\r\n                  }\r\n                  if (c.children && c.children.length > 0) {\r\n                    c.children.forEach(function (b) {\r\n                      if (b.level == 2) {\r\n                        b.expand = false;\r\n                      }\r\n                    });\r\n                  }\r\n                });\r\n              }\r\n            } else if (expandLevel == 2) {\r\n              if (e.level == 0) {\r\n                e.expand = true;\r\n              }\r\n              if (e.children && e.children.length > 0) {\r\n                e.children.forEach(function (c) {\r\n                  if (c.level == 1) {\r\n                    c.expand = false;\r\n                  }\r\n                  if (c.children && c.children.length > 0) {\r\n                    c.children.forEach(function (b) {\r\n                      if (b.level == 2) {\r\n                        b.expand = false;\r\n                      }\r\n                    });\r\n                  }\r\n                });\r\n              }\r\n            } else if (expandLevel == 3) {\r\n              if (e.level == 0) {\r\n                e.expand = true;\r\n              }\r\n              if (e.children && e.children.length > 0) {\r\n                e.children.forEach(function (c) {\r\n                  if (c.level == 1) {\r\n                    c.expand = true;\r\n                  }\r\n                  if (c.children && c.children.length > 0) {\r\n                    c.children.forEach(function (b) {\r\n                      if (b.level == 2) {\r\n                        b.expand = false;\r\n                      }\r\n                    });\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          });\r\n          this.data = res.result;\r\n          let str = JSON.stringify(res.result);\r\n          this.dataEdit = JSON.parse(str);\r\n          // 头部加入一级\r\n          let first = {\r\n            id: \"0\",\r\n            level: -1,\r\n            title: \"一级菜单\",\r\n          };\r\n          this.dataEdit.unshift(first);\r\n        }\r\n      });\r\n    },\r\n    search() {\r\n      if (this.searchKey) {\r\n        this.loading = true;\r\n        searchPermission({ title: this.searchKey }).then((res) => {\r\n          this.loading = false;\r\n          if (res.success) {\r\n            this.data = res.result;\r\n            this.tableData = res.result;\r\n          }\r\n        });\r\n      } else {\r\n        this.getAllList();\r\n        this.getParentList();\r\n      }\r\n    },\r\n    selectTree(v) {\r\n      if (v.length > 0) {\r\n        this.$refs.form.resetFields();\r\n        // 转换null为\"\"\r\n        for (let attr in v[0]) {\r\n          if (v[0][attr] == null) {\r\n            v[0][attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v[0]);\r\n        let data = JSON.parse(str);\r\n        this.form = data;\r\n        this.editTitle = data.title;\r\n      } else {\r\n        this.cancelEdit();\r\n      }\r\n    },\r\n    selectTreeEdit(v) {\r\n      if (v.length > 0) {\r\n        // 转换null为\"\"\r\n        for (let attr in v[0]) {\r\n          if (v[0][attr] == null) {\r\n            v[0][attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v[0]);\r\n        let data = JSON.parse(str);\r\n        if (this.form.id == data.id) {\r\n          this.$Message.warning(\"请勿选择自己作为父节点\");\r\n          v[0].selected = false;\r\n          return;\r\n        }\r\n        // 验证级别level是否正确\r\n        if (this.form.level - 1 != data.level) {\r\n          this.$Message.warning(\"请选择一个\" + this.form.level + \"级菜单节点\");\r\n          v[0].selected = false;\r\n          return;\r\n        }\r\n        this.form.parentId = data.id;\r\n        let level = data.level + 1;\r\n        if (level < 0) {\r\n          level = 0;\r\n        }\r\n        this.form.level = level;\r\n        this.form.parentTitle = data.title;\r\n      }\r\n    },\r\n    cancelEdit() {\r\n      let data = this.$refs.tree.getSelectedNodes()[0];\r\n      if (data) {\r\n        data.selected = false;\r\n      }\r\n      this.$refs.form.resetFields();\r\n      this.form.id = \"\";\r\n      this.editTitle = \"\";\r\n    },\r\n    handleReset() {\r\n      let type = this.form.type;\r\n      this.$refs.form.resetFields();\r\n      this.form.icon = \"\";\r\n      this.form.component = \"\";\r\n      this.form.type = type;\r\n    },\r\n    submitEdit() {\r\n      this.$refs.form.validate((valid) => {\r\n        if (valid) {\r\n          if (!this.form.id) {\r\n            this.$Message.warning(\"请先点击选择要修改的菜单节点\");\r\n            return;\r\n          }\r\n          this.submitLoading = true;\r\n          if (this.form.sortOrder == null) {\r\n            this.form.sortOrder = \"\";\r\n          }\r\n          if (this.form.buttonType == null) {\r\n            this.form.buttonType = \"\";\r\n          }\r\n          if (this.form.type == 1) {\r\n            this.form.name = \"\";\r\n            this.form.icon = \"\";\r\n            this.form.component = \"\";\r\n          }\r\n          editPermission(this.form).then((res) => {\r\n            this.submitLoading = false;\r\n            if (res.success) {\r\n              this.editTitle = this.form.title;\r\n              this.$Message.success(\"编辑成功\");\r\n              // 标记重新获取菜单数据\r\n              this.$store.commit(\"setAdded\", false);\r\n              util.initRouter(this);\r\n              this.init();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    changeEditUrl(e) {\r\n      let v = e.target.value;\r\n      if (v.indexOf(\"http\") > -1) {\r\n        this.form.component = \"sys/monitor/monitor\";\r\n      }\r\n    },\r\n    addRoot() {\r\n      this.isRoot = true;\r\n      this.showAdd = true;\r\n    },\r\n    add() {\r\n      if (!this.form.id) {\r\n        this.$Message.warning(\"请先点击选择一个菜单权限节点\");\r\n        return;\r\n      }\r\n      if (this.form.level == 3) {\r\n        this.$Modal.warning({\r\n          title: \"抱歉，无法继续添加\",\r\n          content: \"左侧菜单最多仅支持二级菜单目录\",\r\n        });\r\n        return;\r\n      }\r\n      this.isRoot = false;\r\n      this.showAdd = true;\r\n    },\r\n    tableAdd(v) {\r\n      this.form = v;\r\n      this.add();\r\n      this.editTitle = \"\";\r\n      let data = this.$refs.tree.getSelectedNodes()[0];\r\n      if (data) {\r\n        data.selected = false;\r\n      }\r\n    },\r\n    addSuccess() {\r\n      // 标记重新获取菜单数据\r\n      this.$store.commit(\"setAdded\", false);\r\n      util.initRouter(this);\r\n      this.init();\r\n    },\r\n    changeSelect(v) {\r\n      this.selectList = v;\r\n    },\r\n    showSelect(e) {\r\n      this.selectList = e;\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    remove(v) {\r\n      this.selectList = [];\r\n      this.selectList.push(v);\r\n      this.delAll();\r\n    },\r\n    delAll() {\r\n      if (this.selectList.length <= 0) {\r\n        this.$Message.warning(\"您还未勾选要删除的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content:\r\n          \"您确认要删除所选的 \" +\r\n          this.selectList.length +\r\n          \" 条数据及其下级所有数据?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function (e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          deletePermission({ ids: ids }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"删除成功\");\r\n              // 标记重新获取菜单数据\r\n              this.$store.commit(\"setAdded\", false);\r\n              util.initRouter(this);\r\n              this.selectList = [];\r\n              this.cancelEdit();\r\n              this.init();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    let height = document.documentElement.clientHeight;\r\n    this.maxHeight = Number(height - 287) + \"px\";\r\n    this.init();\r\n  },\r\n};\r\n</script>"]}]}
{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\own-space\\user.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\own-space\\user.vue","mtime":1651629755204},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1651770037115},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyB1c2VySW5mb0VkaXQgfSBmcm9tICJAL2FwaS9pbmRleCI7DQppbXBvcnQgdXBsb2FkUGljVGh1bWIgZnJvbSAiQC92aWV3cy9teS1jb21wb25lbnRzL3hib290L3VwbG9hZC1waWMtdGh1bWIiOw0KaW1wb3J0IGRpY3QgZnJvbSAiQC92aWV3cy9teS1jb21wb25lbnRzL3hib290L2RpY3QiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7DQogICAgdXBsb2FkUGljVGh1bWIsDQogICAgZGljdCwNCiAgfSwNCiAgbmFtZTogInVzZXIiLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBsb2FkaW5nOiBmYWxzZSwNCiAgICAgIGZvcm06IHsNCiAgICAgICAgYWRkcmVzczogW10sDQogICAgICB9LA0KICAgICAgZXJyb3I6ICIiLA0KICAgIH07DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBpbml0KCkgew0KICAgICAgbGV0IHVzZXJJbmZvID0gdGhpcy5nZXRVc2VySW5mbygpOw0KICAgICAgLy8g6L2s5o2ibnVsbOS4uiIiDQogICAgICBmb3IgKGxldCBhdHRyIGluIHVzZXJJbmZvKSB7DQogICAgICAgIGlmICh1c2VySW5mb1thdHRyXSA9PSBudWxsKSB7DQogICAgICAgICAgdXNlckluZm9bYXR0cl0gPSAiIjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy5mb3JtID0gdXNlckluZm87DQogICAgICBpZiAodXNlckluZm8uYWRkcmVzcykgew0KICAgICAgICBpZiAodHlwZW9mIHVzZXJJbmZvLmFkZHJlc3MgPT0gInN0cmluZyIpIHsNCiAgICAgICAgICB0aGlzLmZvcm0uYWRkcmVzcyA9IHVzZXJJbmZvLmFkZHJlc3Muc3BsaXQoIiwiKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLmZvcm0uYWRkcmVzcyA9IHVzZXJJbmZvLmFkZHJlc3M7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZm9ybS5hZGRyZXNzID0gW107DQogICAgICB9DQogICAgICBpZiAodGhpcy5mb3JtLnR5cGUgPT0gMCkgew0KICAgICAgICB0aGlzLmZvcm0udHlwZVR4dCA9ICLmma7pgJrnlKjmiLciOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmZvcm0udHlwZSA9PSAxKSB7DQogICAgICAgIHRoaXMuZm9ybS50eXBlVHh0ID0gIueuoeeQhuWRmCI7DQogICAgICB9DQogICAgfSwNCiAgICBjaGFuZ2VCaXJ0aCh2KSB7DQogICAgICB0aGlzLmZvcm0uYmlydGggPSB2Ow0KICAgIH0sDQogICAgc2F2ZUVkaXQoKSB7DQogICAgICBpZiAoIXRoaXMuZm9ybS5uaWNrbmFtZSkgew0KICAgICAgICB0aGlzLmVycm9yID0gIuivt+i+k+WFpeeUqOaIt+WQjSI7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZXJyb3IgPSAiIjsNCiAgICAgIH0NCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7DQogICAgICBpZiAodHlwZW9mIHRoaXMuZm9ybS5iaXJ0aCA9PSAib2JqZWN0Iikgew0KICAgICAgICB0aGlzLmZvcm0uYmlydGggPSB0aGlzLmZvcm1hdCh0aGlzLmZvcm0uYmlydGgsICJ5eXl5LU1NLWRkIik7DQogICAgICB9DQogICAgICBkZWxldGUgdGhpcy5mb3JtLnJvbGVzOw0KICAgICAgdXNlckluZm9FZGl0KHRoaXMuZm9ybSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOw0KICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoIuS/neWtmOaIkOWKnyIpOw0KICAgICAgICAgIC8vIOabtOaWsOWktOWDjw0KICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgic2V0Tmlja25hbWUiLCB0aGlzLmZvcm0ubmlja25hbWUpOw0KICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgic2V0QXZhdGFyIiwgdGhpcy5mb3JtLmF2YXRhcik7DQogICAgICAgICAgLy8g6ZyA6KaB5pu05paw55So5oi35L+h5oGvDQogICAgICAgICAgdGhpcy4kZW1pdCgib24tc3VjY2VzcyIsIHRydWUpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuaW5pdCgpOw0KICB9LA0KfTsNCg=="},{"version":3,"sources":["user.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user.vue","sourceRoot":"src/views/own-space","sourcesContent":["<template>\r\n  <div>\r\n    <Form ref=\"form\" :model=\"form\" :label-width=\"90\" label-position=\"left\">\r\n      <FormItem label=\"登录账号：\" prop=\"username\">{{\r\n        form.username\r\n      }}</FormItem>\r\n      <FormItem label=\"用户头像：\">\r\n        <upload-pic-thumb\r\n          v-model=\"form.avatar\"\r\n          :multiple=\"false\"\r\n        ></upload-pic-thumb>\r\n      </FormItem>\r\n      <FormItem label=\"用户名：\" prop=\"nickname\" :error=\"error\">\r\n        <Input v-model=\"form.nickname\" style=\"width: 300px\" />\r\n      </FormItem>\r\n      <FormItem label=\"性别：\">\r\n        <dict dict=\"sex\" v-model=\"form.sex\" style=\"width: 300px\" />\r\n      </FormItem>\r\n      <FormItem label=\"生日：\">\r\n        <DatePicker\r\n          v-model=\"form.birth\"\r\n          @on-change=\"changeBirth\"\r\n          style=\"width: 300px\"\r\n          type=\"date\"\r\n        ></DatePicker>\r\n      </FormItem>\r\n      <FormItem label=\"所在省市：\">\r\n        <al-cascader\r\n          v-model=\"form.address\"\r\n          data-type=\"code\"\r\n          level=\"2\"\r\n          style=\"width: 300px\"\r\n        />\r\n      </FormItem>\r\n      <FormItem label=\"街道地址：\" prop=\"street\">\r\n        <Input v-model=\"form.street\" style=\"width: 300px\" />\r\n      </FormItem>\r\n      <FormItem label=\"个人简介：\" prop=\"description\">\r\n        <Input\r\n          v-model=\"form.description\"\r\n          type=\"textarea\"\r\n          style=\"width: 300px\"\r\n          :autosize=\"{ minRows: 3, maxRows: 5 }\"\r\n          placeholder=\"个人简介\"\r\n        ></Input>\r\n      </FormItem>\r\n      <FormItem label=\"所属部门：\">\r\n        <span>{{ form.departmentTitle }}</span>\r\n      </FormItem>\r\n      <FormItem label=\"用户类型：\">\r\n        <span>{{ form.typeTxt }}</span>\r\n      </FormItem>\r\n      <FormItem>\r\n        <Button\r\n          type=\"primary\"\r\n          style=\"width: 100px; margin-right: 5px\"\r\n          :loading=\"loading\"\r\n          @click=\"saveEdit\"\r\n          >保存</Button\r\n        >\r\n      </FormItem>\r\n    </Form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { userInfoEdit } from \"@/api/index\";\r\nimport uploadPicThumb from \"@/views/my-components/xboot/upload-pic-thumb\";\r\nimport dict from \"@/views/my-components/xboot/dict\";\r\nexport default {\r\n  components: {\r\n    uploadPicThumb,\r\n    dict,\r\n  },\r\n  name: \"user\",\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      form: {\r\n        address: [],\r\n      },\r\n      error: \"\",\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      let userInfo = this.getUserInfo();\r\n      // 转换null为\"\"\r\n      for (let attr in userInfo) {\r\n        if (userInfo[attr] == null) {\r\n          userInfo[attr] = \"\";\r\n        }\r\n      }\r\n      this.form = userInfo;\r\n      if (userInfo.address) {\r\n        if (typeof userInfo.address == \"string\") {\r\n          this.form.address = userInfo.address.split(\",\");\r\n        } else {\r\n          this.form.address = userInfo.address;\r\n        }\r\n      } else {\r\n        this.form.address = [];\r\n      }\r\n      if (this.form.type == 0) {\r\n        this.form.typeTxt = \"普通用户\";\r\n      } else if (this.form.type == 1) {\r\n        this.form.typeTxt = \"管理员\";\r\n      }\r\n    },\r\n    changeBirth(v) {\r\n      this.form.birth = v;\r\n    },\r\n    saveEdit() {\r\n      if (!this.form.nickname) {\r\n        this.error = \"请输入用户名\";\r\n        return;\r\n      } else {\r\n        this.error = \"\";\r\n      }\r\n      this.loading = true;\r\n      if (typeof this.form.birth == \"object\") {\r\n        this.form.birth = this.format(this.form.birth, \"yyyy-MM-dd\");\r\n      }\r\n      delete this.form.roles;\r\n      userInfoEdit(this.form).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.$Message.success(\"保存成功\");\r\n          // 更新头像\r\n          this.$store.commit(\"setNickname\", this.form.nickname);\r\n          this.$store.commit(\"setAvatar\", this.form.avatar);\r\n          // 需要更新用户信息\r\n          this.$emit(\"on-success\", true);\r\n        }\r\n      });\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n};\r\n</script>\r\n"]}]}
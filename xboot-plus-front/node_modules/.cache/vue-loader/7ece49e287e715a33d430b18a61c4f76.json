{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\setting-manage\\sms.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\sys\\setting-manage\\sms.vue","mtime":1651629755231},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1651770037115},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgew0KICBjaGVja1Ntc1NldCwNCiAgc2VlU2VjcmV0U2V0LA0KICBnZXRTbXNTZXQsDQogIGVkaXRTbXNTZXQsDQogIGdldFNtc1RlbXBsYXRlQ29kZSwNCn0gZnJvbSAiQC9hcGkvaW5kZXgiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAic21zIiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbG9hZGluZzogZmFsc2UsIC8vIOihqOWNleWKoOi9veeKtuaAgQ0KICAgICAgY2hhbmdlTG9hZGluZzogZmFsc2UsDQogICAgICBzYXZlTG9hZGluZzogZmFsc2UsDQogICAgICBzbXM6IHsNCiAgICAgICAgc2VydmljZU5hbWU6ICJBTElfU01TIiwNCiAgICAgICAgYWNjZXNzS2V5OiAiIiwNCiAgICAgICAgc2VjcmV0S2V5OiAiIiwNCiAgICAgICAgYXBwSWQ6ICIiLA0KICAgICAgICBzaWduTmFtZTogIiIsDQogICAgICAgIHR5cGU6ICIiLA0KICAgICAgICB0ZW1wbGF0ZUNvZGU6ICIiLA0KICAgICAgfSwNCiAgICAgIGNoYW5nZWRTbXNTSzogZmFsc2UsIC8vIOaYr+WQpuS/ruaUueefreS/oeeahHNlY3JlY3RLZXkNCiAgICAgIHNtc1ZhbGlkYXRlOiB7DQogICAgICAgIC8vIOihqOWNlemqjOivgeinhOWImQ0KICAgICAgICBzZXJ2aWNlTmFtZTogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLor7fpgInmi6kiLCB0cmlnZ2VyOiAiY2hhbmdlIiB9XSwNCiAgICAgICAgYWNjZXNzS2V5OiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIiB9XSwNCiAgICAgICAgc2VjcmV0S2V5OiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIiB9XSwNCiAgICAgICAgYXBwSWQ6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH1dLA0KICAgICAgICBzaWduTmFtZTogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLkuI3og73kuLrnqboiLCB0cmlnZ2VyOiAiYmx1ciIgfV0sDQogICAgICAgIHR5cGU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH1dLA0KICAgICAgICB0ZW1wbGF0ZUNvZGU6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH0sDQogICAgICAgIF0sDQogICAgICB9LA0KICAgIH07DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBpbml0KCkgew0KICAgICAgdGhpcy5pbml0U21zU2V0KCk7DQogICAgfSwNCiAgICBpbml0U21zU2V0KCkgew0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsNCiAgICAgIGNoZWNrU21zU2V0KCkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuc3VjY2VzcyAmJiByZXMucmVzdWx0KSB7DQogICAgICAgICAgbGV0IHNtcyA9IHJlcy5yZXN1bHQ7DQogICAgICAgICAgZ2V0U21zU2V0KHNtcykudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmIChyZXMucmVzdWx0KSB7DQogICAgICAgICAgICAgIC8vIOi9rOaNom51bGzkuLoiIg0KICAgICAgICAgICAgICBmb3IgKGxldCBhdHRyIGluIHJlcy5yZXN1bHQpIHsNCiAgICAgICAgICAgICAgICBpZiAocmVzLnJlc3VsdFthdHRyXSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICByZXMucmVzdWx0W2F0dHJdID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRoaXMuc21zID0gcmVzLnJlc3VsdDsNCiAgICAgICAgICAgICAgdGhpcy5zbXMudHlwZSA9ICIwIjsNCiAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VTbXNUeXBlKHRoaXMuc21zLnR5cGUpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkU21zU0sgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOw0KICAgICAgICAgIHRoaXMuY2hhbmdlZFNtc1NLID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICBjaGFuZ2VTbXModikgew0KICAgICAgdGhpcy4kcmVmcy5zbXNGb3JtLnJlc2V0RmllbGRzKCk7DQogICAgICB0aGlzLmNoYW5nZUxvYWRpbmcgPSB0cnVlOw0KICAgICAgZ2V0U21zU2V0KHYpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICB0aGlzLmNoYW5nZUxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgaWYgKHJlcy5yZXN1bHQpIHsNCiAgICAgICAgICAvLyDovazmjaJudWxs5Li6IiINCiAgICAgICAgICBmb3IgKGxldCBhdHRyIGluIHJlcy5yZXN1bHQpIHsNCiAgICAgICAgICAgIGlmIChyZXMucmVzdWx0W2F0dHJdID09IG51bGwpIHsNCiAgICAgICAgICAgICAgcmVzLnJlc3VsdFthdHRyXSA9ICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLnNtcyA9IHJlcy5yZXN1bHQ7DQogICAgICAgICAgdGhpcy5jaGFuZ2VkU21zU0sgPSBmYWxzZTsNCiAgICAgICAgICB0aGlzLnNtcy50eXBlID0gIjAiOw0KICAgICAgICAgIHRoaXMuY2hhbmdlU21zVHlwZSh0aGlzLnNtcy50eXBlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLnNtcyA9IHsgc2VydmljZU5hbWU6IHYgfTsNCiAgICAgICAgICB0aGlzLnNtcy50eXBlID0gIjAiOw0KICAgICAgICAgIHRoaXMuY2hhbmdlZFNtc1NLID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICBzZWVTZWNyZXQobmFtZSkgew0KICAgICAgaWYgKCFuYW1lKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHNlZVNlY3JldFNldChuYW1lKS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7DQogICAgICAgICAgdGhpcy5zbXMuc2VjcmV0S2V5ID0gcmVzLnJlc3VsdDsNCiAgICAgICAgICB0aGlzLmNoYW5nZWRTbXNTSyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgY2hhbmdlU21zVHlwZSh2KSB7DQogICAgICBpZiAodiA9PSAiIiB8fCB2ID09IG51bGwgfHwgdiA9PSAidW5kZWZpbmVkIikgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBnZXRTbXNUZW1wbGF0ZUNvZGUodGhpcy5zbXMuc2VydmljZU5hbWUsIHYpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAgICB0aGlzLnNtcy50ZW1wbGF0ZUNvZGUgPSByZXMucmVzdWx0Ow0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIHNhdmVFZGl0U21zKCkgew0KICAgICAgdGhpcy4kcmVmcy5zbXNGb3JtLnZhbGlkYXRlKCh2YWxpZCkgPT4gew0KICAgICAgICBpZiAodmFsaWQpIHsNCiAgICAgICAgICB0aGlzLnNhdmVMb2FkaW5nID0gdHJ1ZTsNCiAgICAgICAgICB0aGlzLnNtcy5jaGFuZ2VkID0gdGhpcy5jaGFuZ2VkU21zU0s7DQogICAgICAgICAgZWRpdFNtc1NldCh0aGlzLnNtcykudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgICB0aGlzLnNhdmVMb2FkaW5nID0gZmFsc2U7DQogICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKCLkv53lrZjmiJDlip8iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXQoKTsNCiAgfSwNCn07DQo="},{"version":3,"sources":["sms.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sms.vue","sourceRoot":"src/views/sys/setting-manage","sourcesContent":["<style lang=\"less\">\r\n</style>\r\n<template>\r\n  <div style=\"display: flex; position: relative\">\r\n    <Form\r\n      ref=\"smsForm\"\r\n      :model=\"sms\"\r\n      :label-width=\"110\"\r\n      label-position=\"left\"\r\n      :rules=\"smsValidate\"\r\n    >\r\n      <FormItem label=\"服务提供商\" prop=\"serviceName\">\r\n        <Select\r\n          v-model=\"sms.serviceName\"\r\n          @on-change=\"changeSms\"\r\n          placeholder=\"请选择\"\r\n          style=\"width: 230px\"\r\n        >\r\n          <Option value=\"ALI_SMS\">阿里云</Option>\r\n          <Option value=\"TENCENT_SMS\">腾讯云</Option>\r\n        </Select>\r\n      </FormItem>\r\n      <FormItem label=\"accessKey\" prop=\"accessKey\">\r\n        <Input\r\n          type=\"text\"\r\n          v-model=\"sms.accessKey\"\r\n          placeholder=\"请输入accessKey/secretId\"\r\n          :disabled=\"changeLoading\"\r\n          style=\"width: 380px\"\r\n        />\r\n      </FormItem>\r\n      <FormItem label=\"secretKey\" prop=\"secretKey\">\r\n        <Tooltip placement=\"right\" content=\"无法编辑时请先点击查看图标\">\r\n          <Input\r\n            class=\"input-see\"\r\n            type=\"text\"\r\n            v-model=\"sms.secretKey\"\r\n            :readonly=\"!changedSmsSK\"\r\n            @on-click=\"seeSecret(sms.serviceName)\"\r\n            :disabled=\"changeLoading\"\r\n            icon=\"ios-eye\"\r\n            placeholder=\"请输入secretKey\"\r\n            style=\"width: 380px\"\r\n          />\r\n        </Tooltip>\r\n      </FormItem>\r\n      <FormItem\r\n        v-if=\"sms.serviceName == 'TENCENT_SMS'\"\r\n        label=\"应用ID\"\r\n        prop=\"appId\"\r\n      >\r\n        <Input\r\n          type=\"text\"\r\n          v-model=\"sms.appId\"\r\n          :disabled=\"changeLoading\"\r\n          placeholder=\"请输入应用ID（短信控制台-应用管理）\"\r\n          style=\"width: 380px\"\r\n        />\r\n      </FormItem>\r\n      <FormItem label=\"短信签名\" prop=\"signName\">\r\n        <Input\r\n          type=\"text\"\r\n          v-model=\"sms.signName\"\r\n          :disabled=\"changeLoading\"\r\n          placeholder=\"请输入短信签名，例如XBoot\"\r\n          style=\"width: 380px\"\r\n        />\r\n      </FormItem>\r\n      <FormItem label=\"使用场景\" prop=\"type\">\r\n        <Select\r\n          v-model=\"sms.type\"\r\n          @on-change=\"changeSmsType\"\r\n          :disabled=\"changeLoading\"\r\n          placeholder=\"请选择\"\r\n          style=\"width: 380px\"\r\n          transfer\r\n        >\r\n          <Option value=\"0\">通用验证码</Option>\r\n          <Option value=\"1\">注册</Option>\r\n          <Option value=\"2\">登录</Option>\r\n          <Option value=\"3\">修改绑定手机号</Option>\r\n          <Option value=\"4\">修改密码</Option>\r\n          <Option value=\"5\">重置密码</Option>\r\n          <Option value=\"6\">工作流消息</Option>\r\n        </Select>\r\n      </FormItem>\r\n      <FormItem label=\"模版CODE/ID\" prop=\"templateCode\">\r\n        <Input\r\n          type=\"text\"\r\n          v-model=\"sms.templateCode\"\r\n          :disabled=\"changeLoading\"\r\n          placeholder=\"请输入场景对应短信模版CODE/ID，如SMS_123456789\"\r\n          style=\"width: 380px\"\r\n        />\r\n      </FormItem>\r\n      <FormItem>\r\n        <Button\r\n          type=\"primary\"\r\n          style=\"width: 100px\"\r\n          :disabled=\"changeLoading\"\r\n          :loading=\"saveLoading\"\r\n          @click=\"saveEditSms\"\r\n          >保存更改</Button\r\n        >\r\n      </FormItem>\r\n    </Form>\r\n    <Spin fix v-if=\"loading\"></Spin>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  checkSmsSet,\r\n  seeSecretSet,\r\n  getSmsSet,\r\n  editSmsSet,\r\n  getSmsTemplateCode,\r\n} from \"@/api/index\";\r\nexport default {\r\n  name: \"sms\",\r\n  data() {\r\n    return {\r\n      loading: false, // 表单加载状态\r\n      changeLoading: false,\r\n      saveLoading: false,\r\n      sms: {\r\n        serviceName: \"ALI_SMS\",\r\n        accessKey: \"\",\r\n        secretKey: \"\",\r\n        appId: \"\",\r\n        signName: \"\",\r\n        type: \"\",\r\n        templateCode: \"\",\r\n      },\r\n      changedSmsSK: false, // 是否修改短信的secrectKey\r\n      smsValidate: {\r\n        // 表单验证规则\r\n        serviceName: [{ required: true, message: \"请选择\", trigger: \"change\" }],\r\n        accessKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        secretKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        appId: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        signName: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        type: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        templateCode: [\r\n          { required: true, message: \"不能为空\", trigger: \"blur\" },\r\n        ],\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.initSmsSet();\r\n    },\r\n    initSmsSet() {\r\n      this.loading = true;\r\n      checkSmsSet().then((res) => {\r\n        if (res.success && res.result) {\r\n          let sms = res.result;\r\n          getSmsSet(sms).then((res) => {\r\n            this.loading = false;\r\n            if (res.result) {\r\n              // 转换null为\"\"\r\n              for (let attr in res.result) {\r\n                if (res.result[attr] == null) {\r\n                  res.result[attr] = \"\";\r\n                }\r\n              }\r\n              this.sms = res.result;\r\n              this.sms.type = \"0\";\r\n              this.changeSmsType(this.sms.type);\r\n            } else {\r\n              this.changedSmsSK = true;\r\n            }\r\n          });\r\n        } else {\r\n          this.loading = false;\r\n          this.changedSmsSK = true;\r\n        }\r\n      });\r\n    },\r\n    changeSms(v) {\r\n      this.$refs.smsForm.resetFields();\r\n      this.changeLoading = true;\r\n      getSmsSet(v).then((res) => {\r\n        this.changeLoading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] == null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.sms = res.result;\r\n          this.changedSmsSK = false;\r\n          this.sms.type = \"0\";\r\n          this.changeSmsType(this.sms.type);\r\n        } else {\r\n          this.sms = { serviceName: v };\r\n          this.sms.type = \"0\";\r\n          this.changedSmsSK = true;\r\n        }\r\n      });\r\n    },\r\n    seeSecret(name) {\r\n      if (!name) {\r\n        return;\r\n      }\r\n      seeSecretSet(name).then((res) => {\r\n        if (res.success) {\r\n          this.sms.secretKey = res.result;\r\n          this.changedSmsSK = true;\r\n        }\r\n      });\r\n    },\r\n    changeSmsType(v) {\r\n      if (v == \"\" || v == null || v == \"undefined\") {\r\n        return;\r\n      }\r\n      getSmsTemplateCode(this.sms.serviceName, v).then((res) => {\r\n        if (res.success) {\r\n          this.sms.templateCode = res.result;\r\n        }\r\n      });\r\n    },\r\n    saveEditSms() {\r\n      this.$refs.smsForm.validate((valid) => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.sms.changed = this.changedSmsSK;\r\n          editSmsSet(this.sms).then((res) => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n};\r\n</script>"]}]}
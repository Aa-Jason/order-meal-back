{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\my-components\\xboot\\user-select.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\my-components\\xboot\\user-select.vue","mtime":1651629755200},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1651770028580},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1651770027142},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\postcss-loader\\src\\index.js","mtime":1651770027415},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":1651770042155},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi51c2VyLXNlbGVjdC1kcmF3ZXIgew0KICAuc2VsZWN0LWNvdW50IHsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiAjNDBhOWZmOw0KICB9DQogIC5kcm9wLWRvd24gew0KICAgIG1hcmdpbi1sZWZ0OiA1cHg7DQogIH0NCn0NCg=="},{"version":3,"sources":["user-select.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user-select.vue","sourceRoot":"src/views/my-components/xboot","sourcesContent":["<template>\r\n  <div>\r\n    <div style=\"display: flex\">\r\n      <Select\r\n        v-model=\"value\"\r\n        :size=\"size\"\r\n        :loading=\"loading\"\r\n        :placeholder=\"placeholder\"\r\n        :multiple=\"multiple\"\r\n        :disabled=\"disabled\"\r\n        filterable\r\n        :transfer=\"transfer\"\r\n        :clearable=\"clearable\"\r\n        :placement=\"placement\"\r\n        :not-found-text=\"notFoundText\"\r\n        :label-in-value=\"labelInValue\"\r\n        :transfer-class-name=\"transferClassName\"\r\n        :prefix=\"prefix\"\r\n        :max-tag-count=\"maxTagCount\"\r\n        :max-tag-placeholder=\"maxTagPlaceholder\"\r\n        @on-change=\"handleChange\"\r\n        @on-query-change=\"handleQueryChange\"\r\n        @on-clear=\"handleClear\"\r\n        @on-open-change=\"handleOpenChange\"\r\n        @on-select=\"handleSelect\"\r\n        :remote-method=\"searchUser\"\r\n      >\r\n        <Option\r\n          v-for=\"(item, i) in userList\"\r\n          :value=\"item.id\"\r\n          :key=\"i\"\r\n          :label=\"item.nickname\"\r\n          :tag=\"item.username\"\r\n        >\r\n          <span style=\"margin-right: 10px\">{{ item.nickname }}</span>\r\n          <span style=\"color: #ccc\">{{ item.username }}</span>\r\n        </Option>\r\n      </Select>\r\n      <Button\r\n        v-if=\"showButton\"\r\n        @click=\"userModalVisible = true\"\r\n        :size=\"size\"\r\n        :disabled=\"disabled\"\r\n        :icon=\"icon\"\r\n        :type=\"type\"\r\n        :shape=\"shape\"\r\n        :ghost=\"ghost\"\r\n        style=\"margin-left: 10px\"\r\n        >{{ text }}</Button\r\n      >\r\n    </div>\r\n    <Drawer\r\n      v-if=\"showButton\"\r\n      title=\"选择用户\"\r\n      closable\r\n      v-model=\"userModalVisible\"\r\n      width=\"815\"\r\n      draggable\r\n      :transfer=\"drawerTransfer\"\r\n      :mask-style=\"maskStyle\"\r\n      :class-name=\"className\"\r\n      class=\"user-select-drawer\"\r\n    >\r\n      <Form ref=\"searchForm\" :model=\"searchForm\" inline :label-width=\"70\">\r\n        <FormItem label=\"用户名\" prop=\"nickname\">\r\n          <Input\r\n            type=\"text\"\r\n            v-model=\"searchForm.nickname\"\r\n            clearable\r\n            placeholder=\"请输入用户名\"\r\n            style=\"width: 180px\"\r\n          />\r\n        </FormItem>\r\n        <FormItem label=\"部门\" prop=\"department\">\r\n          <department-choose\r\n            @on-change=\"handleSelectDep\"\r\n            style=\"width: 180px\"\r\n            ref=\"dep\"\r\n          ></department-choose>\r\n        </FormItem>\r\n        <span v-if=\"drop\">\r\n          <FormItem label=\"手机号\" prop=\"mobile\">\r\n            <Input\r\n              type=\"text\"\r\n              v-model=\"searchForm.mobile\"\r\n              clearable\r\n              placeholder=\"请输入手机号\"\r\n              style=\"width: 180px\"\r\n            />\r\n          </FormItem>\r\n          <FormItem label=\"邮箱\" prop=\"email\">\r\n            <Input\r\n              type=\"text\"\r\n              v-model=\"searchForm.email\"\r\n              clearable\r\n              placeholder=\"请输入邮箱\"\r\n              style=\"width: 180px\"\r\n            />\r\n          </FormItem>\r\n          <FormItem label=\"性别\" prop=\"sex\">\r\n            <dict dict=\"sex\" v-model=\"searchForm.sex\" style=\"width: 180px\" />\r\n          </FormItem>\r\n          <FormItem label=\"登录账号\" prop=\"username\">\r\n            <Input\r\n              type=\"text\"\r\n              v-model=\"searchForm.username\"\r\n              clearable\r\n              placeholder=\"请输入登录账号\"\r\n              style=\"width: 180px\"\r\n            />\r\n          </FormItem>\r\n          <FormItem label=\"用户ID\" prop=\"id\">\r\n            <Input\r\n              type=\"text\"\r\n              v-model=\"searchForm.id\"\r\n              clearable\r\n              placeholder=\"请输入用户ID\"\r\n              style=\"width: 180px\"\r\n            />\r\n          </FormItem>\r\n        </span>\r\n        <FormItem style=\"margin-left: -35px\" class=\"br\">\r\n          <Button @click=\"handleSearchUser\" type=\"primary\" icon=\"ios-search\"\r\n            >搜索</Button\r\n          >\r\n          <Button @click=\"handleResetUser\">重置</Button>\r\n          <a class=\"drop-down\" @click=\"dropDown\">\r\n            {{ dropDownContent }}\r\n            <Icon :type=\"dropDownIcon\"></Icon>\r\n          </a>\r\n        </FormItem>\r\n      </Form>\r\n      <Alert show-icon>\r\n        已选择\r\n        <span class=\"select-count\">{{ selectCount }}</span> 项\r\n        <a style=\"margin-left: 10px\" @click=\"clearData\">清空已选</a>\r\n      </Alert>\r\n      <Table\r\n        :loading=\"userLoading\"\r\n        border\r\n        :columns=\"userColumns\"\r\n        :data=\"userData\"\r\n        style=\"margin: 2vh 0\"\r\n      ></Table>\r\n      <Row type=\"flex\" justify=\"end\">\r\n        <Page\r\n          :current=\"searchForm.pageNumber\"\r\n          :total=\"totalUser\"\r\n          :page-size=\"searchForm.pageSize\"\r\n          @on-change=\"changePage\"\r\n          @on-page-size-change=\"changePageSize\"\r\n          :page-size-opts=\"[10, 20, 50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n          :transfer=\"true\"\r\n        ></Page>\r\n      </Row>\r\n    </Drawer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { searchUserByName, getUserListData } from \"@/api/index\";\r\nimport departmentChoose from \"./department-choose\";\r\nimport dict from \"@/views/my-components/xboot/dict\";\r\nexport default {\r\n  name: \"userSelect\",\r\n  components: {\r\n    departmentChoose,\r\n    dict,\r\n  },\r\n  props: {\r\n    showButton: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    text: {\r\n      type: String,\r\n      default: \"选择用户\",\r\n    },\r\n    icon: {\r\n      type: String,\r\n      default: \"md-person-add\",\r\n    },\r\n    size: String,\r\n    type: String,\r\n    shape: String,\r\n    ghost: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    transfer: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    drawerTransfer: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    placeholder: {\r\n      type: String,\r\n      default: \"请输入用户名搜索选择用户\",\r\n    },\r\n    placement: {\r\n      type: String,\r\n      default: \"bottom-start\",\r\n    },\r\n    multiple: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    notFoundText: {\r\n      type: String,\r\n      default: \"无匹配数据\",\r\n    },\r\n    labelInValue: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    transferClassName: String,\r\n    prefix: String,\r\n    maxTagCount: Number,\r\n    maxTagPlaceholder: Function,\r\n    clearable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    maskStyle: Object,\r\n    className: Object\r\n  },\r\n  data() {\r\n    return {\r\n      value: null,\r\n      userList: [],\r\n      loading: false,\r\n      userLoading: true,\r\n      userModalVisible: false,\r\n      drop: false,\r\n      dropDownContent: \"展开\",\r\n      dropDownIcon: \"ios-arrow-down\",\r\n      selectCount: 0,\r\n      searchForm: {\r\n        id: \"\",\r\n        nickname: \"\",\r\n        type: \"\",\r\n        status: \"\",\r\n        pageNumber: 1, // 当前页数\r\n        pageSize: 10, // 页面大小\r\n        sort: \"createTime\", // 默认排序字段\r\n        order: \"desc\", // 默认排序方式\r\n      },\r\n      userColumns: [\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          title: \"用户名\",\r\n          key: \"nickname\",\r\n          minWidth: 130,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"登录账号\",\r\n          key: \"username\",\r\n          minWidth: 130,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"头像\",\r\n          key: \"avatar\",\r\n          width: 80,\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            return h(\"Avatar\", {\r\n              props: {\r\n                src: params.row.avatar,\r\n              },\r\n            });\r\n          },\r\n        },\r\n        {\r\n          title: \"所属部门\",\r\n          key: \"departmentTitle\",\r\n          width: 120,\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          width: 125,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"邮箱\",\r\n          key: \"email\",\r\n          width: 180,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"性别\",\r\n          key: \"sex\",\r\n          width: 70,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\",\r\n          width: 170,\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          width: 130,\r\n          align: \"center\",\r\n          fixed: \"right\",\r\n          render: (h, params) => {\r\n            let title = \"添加用户\";\r\n            if (!this.multiple) {\r\n              title = \"选择用户\";\r\n            }\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"default\",\r\n                    size: \"small\",\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.addUser(params.row);\r\n                    },\r\n                  },\r\n                },\r\n                title\r\n              ),\r\n            ]);\r\n          },\r\n        },\r\n      ],\r\n      userData: [],\r\n      totalUser: 0,\r\n    };\r\n  },\r\n  methods: {\r\n    searchUser(v) {\r\n      if (!v) {\r\n        return;\r\n      }\r\n      this.loading = true;\r\n      searchUserByName(v).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.userList = res.result;\r\n        }\r\n      });\r\n    },\r\n    handleChange(v) {\r\n      this.$emit(\"input\", v);\r\n      this.$emit(\"on-change\", v);\r\n    },\r\n    handleQueryChange(v) {\r\n      this.$emit(\"on-query-change\", v);\r\n    },\r\n    handleClear() {\r\n      this.$emit(\"on-clear\", \"\");\r\n    },\r\n    handleOpenChange(v) {\r\n      this.$emit(\"on-open-change\", v);\r\n    },\r\n    handleSelect(v) {\r\n      this.$emit(\"on-select\", v);\r\n    },\r\n    setData(v) {\r\n      if (!v.length && v.length != 0) {\r\n        // 单个\r\n        if (this.multiple) {\r\n          this.$Message.warning(\"多个选择仅支持传入用户数组数据\");\r\n          return;\r\n        }\r\n        if (!v) {\r\n          return;\r\n        }\r\n        let list = [v];\r\n        this.userList = list;\r\n        setTimeout(() => {\r\n          this.value = v.id;\r\n          this.$emit(\"input\", v.id);\r\n          this.selectCount = 1;\r\n        }, 10);\r\n      } else if (v.length > 0) {\r\n        // 多个\r\n        if (!this.multiple) {\r\n          this.$Message.warning(\"单个选择仅支持传入单个用户数据\");\r\n          return;\r\n        }\r\n        let list = [],\r\n          ids = [];\r\n        v.forEach((e) => {\r\n          list.push(e);\r\n          ids.push(e.id);\r\n        });\r\n        this.userList = list;\r\n        setTimeout(() => {\r\n          this.value = ids;\r\n          this.$emit(\"input\", ids);\r\n          this.selectCount = v.length;\r\n        }, 10);\r\n      } else {\r\n        if (this.multiple) {\r\n          this.value = [];\r\n          this.$emit(\"input\", []);\r\n        } else {\r\n          this.value = \"\";\r\n          this.$emit(\"input\", \"\");\r\n        }\r\n      }\r\n    },\r\n    handleSelectDep(v) {\r\n      this.searchForm.departmentId = v;\r\n    },\r\n    dropDown() {\r\n      if (this.drop) {\r\n        this.dropDownContent = \"展开\";\r\n        this.dropDownIcon = \"ios-arrow-down\";\r\n      } else {\r\n        this.dropDownContent = \"收起\";\r\n        this.dropDownIcon = \"ios-arrow-up\";\r\n      }\r\n      this.drop = !this.drop;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getDataList();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getDataList();\r\n    },\r\n    getDataList() {\r\n      this.userLoading = true;\r\n      getUserListData(this.searchForm).then((res) => {\r\n        this.userLoading = false;\r\n        if (res.success) {\r\n          this.userData = res.result.content;\r\n          this.totalUser = res.result.totalElements;\r\n        }\r\n      });\r\n    },\r\n    handleSearchUser() {\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getDataList();\r\n    },\r\n    handleResetUser() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.$refs.dep.clearSelect();\r\n      this.searchForm.departmentId = \"\";\r\n      // 重新加载数据\r\n      this.getDataList();\r\n    },\r\n    clearData() {\r\n      this.selectCount = 0;\r\n      if (this.multiple) {\r\n        this.value = [];\r\n        this.$emit(\"input\", []);\r\n        this.$emit(\"on-change\", []);\r\n      } else {\r\n        this.value = \"\";\r\n        this.$emit(\"input\", \"\");\r\n        this.$emit(\"on-change\", \"\");\r\n      }\r\n    },\r\n    addUser(v) {\r\n      if (this.multiple) {\r\n        // 去重\r\n        let flag = true;\r\n        if (this.value && this.value.length > 0) {\r\n          this.value.forEach((e) => {\r\n            if (v.id == e) {\r\n              this.$Message.warning(\"已经添加过啦，请勿重复选择\");\r\n              flag = false;\r\n            }\r\n          });\r\n        } else {\r\n          this.value = [];\r\n        }\r\n        if (flag) {\r\n          let u = {\r\n            id: v.id,\r\n            username: v.username,\r\n            nickname: v.nickname,\r\n          };\r\n          let isExist = false;\r\n          this.userList.forEach((e) => {\r\n            if (v.id == e.id) {\r\n              isExist = true;\r\n            }\r\n          });\r\n          if (!isExist) {\r\n            this.userList.push(u);\r\n          }\r\n          setTimeout(() => {\r\n            this.value.push(v.id);\r\n            this.$emit(\"input\", this.value);\r\n            this.$emit(\"on-change\", this.value);\r\n            this.selectCount = this.value.length;\r\n          }, 10);\r\n          this.$Message.success(`添加用户 ${v.nickname} 成功`);\r\n        }\r\n      } else {\r\n        // 单选\r\n        this.userList = [\r\n          {\r\n            id: v.id,\r\n            username: v.username,\r\n            nickname: v.nickname,\r\n          },\r\n        ];\r\n        setTimeout(() => {\r\n          this.value = v.id;\r\n          this.$emit(\"input\", this.value);\r\n          this.$emit(\"on-change\", this.value);\r\n          this.selectCount = 1;\r\n        }, 10);\r\n        this.$Message.success(`选择用户 ${v.nickname} 成功`);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.getDataList();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\">\r\n.user-select-drawer {\r\n  .select-count {\r\n    font-weight: 600;\r\n    color: #40a9ff;\r\n  }\r\n  .drop-down {\r\n    margin-left: 5px;\r\n  }\r\n}\r\n</style>"]}]}
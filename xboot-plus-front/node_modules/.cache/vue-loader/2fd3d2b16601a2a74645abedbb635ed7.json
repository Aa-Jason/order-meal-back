{"remainingRequest":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\my-components\\xboot\\file-upload.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\src\\views\\my-components\\xboot\\file-upload.vue","mtime":1651629755193},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1651770028580},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1651770027142},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\postcss-loader\\src\\index.js","mtime":1651770027415},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":1651770042155},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651770036753},{"path":"D:\\work\\workspace\\order\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1651770027133}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmZpbGUtdXBsb2FkLXdyYXAtbm9idXR0b24gew0KICAuaXZ1LXVwbG9hZC1saXN0IHsNCiAgICBtYXJnaW4tdG9wOiAtMjBweDsNCiAgfQ0KfQ0K"},{"version":3,"sources":["file-upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkSA;AACA;AACA;AACA;AACA","file":"file-upload.vue","sourceRoot":"src/views/my-components/xboot","sourcesContent":["<template>\r\n  <div>\r\n    <div :class=\"{ 'file-upload-wrap-nobutton': !showUpload }\">\r\n      <Upload\r\n        :action=\"uploadFileUrl\"\r\n        :headers=\"accessToken\"\r\n        :on-success=\"handleSuccess\"\r\n        :on-error=\"handleError\"\r\n        :format=\"format\"\r\n        :accept=\"accept\"\r\n        :max-size=\"maxSize * 1024\"\r\n        :on-format-error=\"handleFormatError\"\r\n        :on-exceeded-size=\"handleMaxSize\"\r\n        :before-upload=\"beforeUpload\"\r\n        :default-file-list=\"fileList\"\r\n        :on-preview=\"handlePreview\"\r\n        :on-remove=\"handleRemove\"\r\n        ref=\"upload\"\r\n      >\r\n        <Button\r\n          :type=\"type\"\r\n          :ghost=\"ghost\"\r\n          :shape=\"shape\"\r\n          :size=\"size\"\r\n          :disabled=\"disabled\"\r\n          :icon=\"icon\"\r\n          v-show=\"showUpload\"\r\n          >{{ text }}</Button\r\n        >\r\n      </Upload>\r\n      <span v-show=\"!showUpload && fileList.length < 1\">{{ noDataText }}</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { uploadFile } from \"@/api/index\";\r\nexport default {\r\n  name: \"fileUpload\",\r\n  props: {\r\n    value: null,\r\n    size: String,\r\n    type: String,\r\n    multi: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    limit: {\r\n      type: Number,\r\n      default: 10,\r\n    },\r\n    ghost: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    shape: String,\r\n    icon: {\r\n      type: String,\r\n      default: \"ios-cloud-upload-outline\",\r\n    },\r\n    text: {\r\n      type: String,\r\n      default: \"上传文件\",\r\n    },\r\n    maxSize: {\r\n      type: Number,\r\n      default: 5,\r\n    },\r\n    accept: String,\r\n    showUpload: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    noDataText: {\r\n      type: String,\r\n      default: \"暂无数据\",\r\n    },\r\n    showTip: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    tipSize: {\r\n      type: Number,\r\n      default: 50,\r\n    },\r\n  },\r\n  computed: {\r\n    format() {\r\n      if (this.accept) {\r\n        let format = [];\r\n        this.accept.split(\",\").forEach((e) => {\r\n          format.push(e.replace(\".\", \"\").replace(\" \", \"\"));\r\n        });\r\n        return format;\r\n      } else {\r\n        return [];\r\n      }\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      accessToken: {},\r\n      currentValue: this.value,\r\n      uploadFileUrl: uploadFile,\r\n      fileList: [],\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.accessToken = {\r\n        accessToken: this.getStore(\"accessToken\"),\r\n      };\r\n      this.setCurrentValue(this.value);\r\n    },\r\n    handleFormatError(file) {\r\n      this.$Notice.warning({\r\n        title: \"不支持的文件格式\",\r\n        desc:\r\n          \"所选文件‘ \" +\r\n          file.name +\r\n          \" ’格式不正确, 请选择 \" +\r\n          this.accept +\r\n          \" 格式文件\",\r\n      });\r\n    },\r\n    handleMaxSize(file) {\r\n      this.$Notice.warning({\r\n        title: \"文件大小过大\",\r\n        desc:\r\n          \"所选文件‘ \" +\r\n          file.name +\r\n          \" ’大小过大, 不得超过 \" +\r\n          this.maxSize +\r\n          \"M.\",\r\n      });\r\n    },\r\n    beforeUpload(file) {\r\n      if (this.multi && this.fileList.length >= this.limit) {\r\n        this.$Message.warning(\"最多只能上传\" + this.limit + \"张图片\");\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    handleSuccess(res, file, fileList) {\r\n      if (res.success) {\r\n        if (this.multi) {\r\n          this.currentValue.push({\r\n            url: res.result,\r\n            name: file.name,\r\n            size: file.size,\r\n          });\r\n        } else {\r\n          this.currentValue = {\r\n            url: res.result,\r\n            name: file.name,\r\n            size: file.size,\r\n          };\r\n        }\r\n        this.$emit(\"input\", this.currentValue);\r\n        this.$emit(\"on-change\", this.currentValue);\r\n      } else {\r\n        file.percentage = 0;\r\n        file.status = \"fail\";\r\n        file.name += \"（上传失败）\";\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    handleError(error, file, fileList) {\r\n      this.$Message.error(error.toString());\r\n    },\r\n    handlePreview(file) {\r\n      let showTip =\r\n        this.showTip && file.size && file.size > this.tipSize * 1024 * 1024;\r\n      if (showTip) {\r\n        this.$Modal.confirm({\r\n          title: \"文件较大提示\",\r\n          content: \"该文件大小已超过 \" + this.tipSize + \" MB，确认下载？\",\r\n          okText: \"继续下载\",\r\n          onOk: () => {\r\n            this.download(file);\r\n          },\r\n        });\r\n      } else {\r\n        this.download(file);\r\n      }\r\n    },\r\n    download(file) {\r\n      if (!file.url) {\r\n        this.$Message.error(\"无效的链接\");\r\n        return;\r\n      }\r\n      window.open(\r\n        file.url +\r\n          \"?attname=&response-content-type=application/octet-stream&filename=\" +\r\n          file.name\r\n      );\r\n    },\r\n    handleRemove(file, fileList) {\r\n      if (this.multi) {\r\n        let re = [];\r\n        fileList.forEach((e) => {\r\n          if (e.status == \"finished\") {\r\n            re.push({\r\n              url: e.url,\r\n              name: e.name,\r\n              size: e.size,\r\n            });\r\n          }\r\n        });\r\n        this.fileList = re;\r\n        this.currentValue = re;\r\n      } else {\r\n        if (fileList.length > 0 && fileList[0].status == \"finished\") {\r\n          this.currentValue = {\r\n            url: fileList[0].url,\r\n            name: fileList[0].name,\r\n            size: fileList[0].size,\r\n          };\r\n          this.fileList = [this.currentValue];\r\n        } else {\r\n          this.currentValue = {};\r\n        }\r\n      }\r\n      this.$emit(\"input\", this.currentValue);\r\n      this.$emit(\"on-change\", this.currentValue);\r\n    },\r\n    setCurrentValue(v) {\r\n      if (!v.length && v.length != 0) {\r\n        // 单个\r\n        if (this.multi) {\r\n          this.$Message.warning(\"多个上传仅支持传入数组数据类型\");\r\n          return;\r\n        }\r\n        if (!v.name && !v.url) {\r\n          return;\r\n        }\r\n        this.currentValue = v;\r\n        this.fileList.push(v);\r\n      } else {\r\n        // 多个\r\n        if (!this.multi) {\r\n          this.$Message.warning(\"单个上传仅支持传入字符串数据类型\");\r\n          return;\r\n        }\r\n        if (v.length > this.limit) {\r\n          for (let i = 0; i < this.limit; i++) {\r\n            this.fileList.push({\r\n              url: v[i].url,\r\n              name: v[i].name,\r\n              size: v[i].size,\r\n            });\r\n          }\r\n          this.currentValue = this.fileList;\r\n          this.$emit(\"input\", this.currentValue);\r\n          this.$Message.warning(\"最多只能上传\" + this.limit + \"个文件\");\r\n        } else {\r\n          this.currentValue = v;\r\n          this.fileList = v;\r\n        }\r\n      }\r\n      this.count = this.currentValue.length;\r\n      this.$emit(\"on-change\", this.currentValue);\r\n    },\r\n    clear() {\r\n      this.$refs.upload.clearFiles();\r\n      if (this.multi) {\r\n        this.currentValue = [];\r\n      } else {\r\n        this.currentValue = {};\r\n      }\r\n      this.$emit(\"input\", this.currentValue);\r\n      this.$emit(\"on-change\", this.currentValue);\r\n    },\r\n  },\r\n  watch: {\r\n    value(val) {\r\n      this.setCurrentValue(val);\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.file-upload-wrap-nobutton {\r\n  .ivu-upload-list {\r\n    margin-top: -20px;\r\n  }\r\n}\r\n</style>\r\n\r\n"]}]}